# Java New I/O
## 缓冲区(Buffer)
属性
- 容量(Capacity)
缓冲区能够容纳的数据元素的最大数量，这一容量在缓冲区创建时被设定，并且永远不能被改变。
- 上界(Limit)
缓冲区第一个不能被读或写的元素。或者说，缓冲区中现存元素的计数。
- 位置(Position)
下一个要被读或者写的元素的索引。位置会自动由相应的get()和put()函数更新
- 标记(Mark)
一个备忘位置。调用mark()来设定mark=position。调用reset()设定position=mark。标记在设定前是未定义的

四个属性遵循以下关系：
0 <= mark <= position <= limit <= capacity

> 所有缓冲区都是可读的，但并非所有都可写。

### 存取
缓冲区中的put和get可以是相对的或者是绝对的。相对方案是不带有索引参数的函数。当相对函数被调用时，位置(position)在返回时前进1，如果位置前进过多，相对运算就会抛出异常。绝对存取不会影响缓冲区的位置属性，但是如果调用时提供的索引超过范围（负数或不小于上界）也会抛出异常。
### 填充
看个例子将代表"Hello"字符串的ASCII骂载入一个名为buffer的ByteBuffer对象中

```java
buffer.put((byte)'H').put((byte)'e')put((byte)'l')put((byte)'l')put((byte)'o');
```
五次调用put()之后的缓冲区

![image](https://github.com/johnxue2013/docs/blob/master/images/2_3.jpg)


> 在java中字符以Unicode码表示,每个Unicode字符占16位。
### 翻转
当写满了缓冲区，现在我们必须准备将其清空。把缓冲区传递给一个通道，以使内容能被全部写出。但如果通道现在在缓冲区上执行get()，那么它将从我们刚刚插入有用数据之外取出未定义的数据。如果我们将位置设置为0，通道就会从正确的位置开始获取，但是是怎样知道何时到达我们插入数据的末端的呢？这就是上界属性被引入的目的。上界属性指明了缓冲区有效内容的末端。我们需要将上界(limit)属性设置为当前位置(position)，然后将位置重置为0。可以人工用下面代码实现
```java
buffer.limit(position).position(0);
```
但这种从填充状态到释放状态的缓冲区翻转是API设计者预先设计好的，他们为我们提供一个非常便利的函数"
```java
buffer.flip()
```
`flip()`函数将一个能够继续添加数据元素的填充状态的缓冲区翻转成一个准备读出元素的释放状态。
